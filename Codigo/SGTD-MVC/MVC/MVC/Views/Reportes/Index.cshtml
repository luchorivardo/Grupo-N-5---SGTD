@model IEnumerable<MVC.Models.DTOs.FacturaDto.FacturaReadDTO>

@{
    ViewData["Title"] = "Reportes";
}

<link rel="stylesheet" href="~/css/indexBase.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/botones.css" asp-append-version="true" />

<div class="content-container p-3 proveedores-page">
    <!-- Fila superior: filtro + acciones rápidas -->
    <div class="d-flex justify-content-between align-items-center w-100 mb-3 gap-2">
        <!-- Contenedor principal flex -->
        <div class="d-flex align-items-center gap-2" style="width: 100%;">
            <!-- Input de búsqueda (flex:3) -->
            <div class="search-wrapper flex-grow-3" style="flex:3;">
                <label for="q" class="me-2 visually-hidden">Buscar</label>
                <div class="input-group">
                    <span class="input-group-text bg-dark border-0" style="color: #dedede; padding: 5px 8px; border-radius: 8px 0 0 8px;">
                        <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M42 42L33.3 33.3M38 22C38 30.8366 30.8366 38 22 38C13.1634 38 6 30.8366 6 22C6 13.1634 13.1634 6 22 6C30.8366 6 38 13.1634 38 22Z" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </span>
                    <input id="q" type="text" class="form-control search-input" placeholder="Buscar por cliente, n° factura, emisor..." />
                </div>
            </div>

            <!-- Contenedor de botones (flex:1) -->
            <div class="d-flex gap-2 flex-grow-1" style="flex:1; justify-content: flex-end;">
                <button class="btn btn-outline-secondary d-flex align-items-center gap-1 flex-grow-1 justify-content-center">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 6H20M8 12H16M11 18H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Fecha
                </button>
                <button class="btn btn-outline-secondary d-flex align-items-center gap-1 flex-grow-1 justify-content-center">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 17V20M4 17V4M4 17H7M12 17V20M12 17V10M12 17H15M20 17V20M20 17V13M20 17H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Exportar
                </button>
            </div>
        </div>
    </div>

    <!-- Tabla dentro de un contenedor con scroll -->
    <div class="table-card">
        <div class="table-responsive proveedores-table-wrapper">
            <table class="table proveedores-table mb-0">
                <thead>
                    <tr>
                        <th>Razon Social</th>
                        <th>Nro Factura</th>
                        <th>Cliente</th>
                        <th>Cantidad Productos</th>
                        <th>Valor</th>
                        <th>Id Fiscal</th>
                        <th>Descripcion</th>
                        <th>Usuario</th>
                        <th>Fecha Emision</th>

                    </tr>
                </thead>
                <tbody id="tabla-body">
                    @* Ejemplo: recorriendo el modelo *@
                    @if (Model != null)
                    {
                        foreach (var reporte in Model)
                        {
                            <tr class="cursor-pointer" onclick="seleccionarFila(this, @reporte.Id)">
                                <td>@reporte.RazonSocial</td>
                                <td>@reporte.Id</td>
                                <td>@reporte.ClienteId</td>
                                <td>@reporte.CantidadProductos</td>
                                <td class="fw-bold">@reporte.Monto.ToString("C")</td>
                                 <td>@reporte.IdFiscal</td>
                                <td>@reporte.Descripcion</td>
                                <td>@reporte.UsuarioId</td>
                                <td>@reporte.FechaEmision.ToString("dd/MM/yyyy")</td>
                                
                            </tr>
                        }
                    }
                    else
                    {
                        <tr><td colspan="5" class="text-center text-muted">No hay reportes disponibles</td></tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="actions-row mt-3 d-flex flex-wrap gap-3 justify-content-between sticky-footer">
            <button id="btnGenerarVenta" class="btn btn-lg btn-add">GENERAR VENTA</button>
            <div class="ms-auto d-flex gap-2">
                <button id="btnVerDetalles" class="btn btn-lg btn-edit" disabled>VER DETALLES</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Variables para controlar la selección
        let reporteSeleccionado = null;

        // Función para seleccionar una fila
        function seleccionarFila(fila, idReporte) {
            // Remover selección previa
            document.querySelectorAll('#tabla-body tr').forEach(r => {
                r.classList.remove('selected-row');
            });

            // Marcar nueva selección
            fila.classList.add('selected-row');
            reporteSeleccionado = idReporte;

            // Habilitar botón de ver detalles
            document.getElementById('btnVerDetalles').disabled = false;
        }

        // Simple filtro cliente (opcional) — filtra por texto en la tabla
        document.getElementById('q').addEventListener('input', function () {
            const q = this.value.toLowerCase();
            const rows = document.querySelectorAll('#tabla-body tr');
            rows.forEach(r => {
                const text = r.innerText.toLowerCase();
                r.style.display = text.includes(q) ? '' : 'none';
            });
        });

        // Configurar botón de ver detalles
        document.getElementById('btnVerDetalles').addEventListener('click', function() {
            if (reporteSeleccionado) {
                window.location.href = `/Reportes/Detalles/${reporteSeleccionado}`;
            }
        });

        // Configurar botón de generar venta
        document.getElementById('btnGenerarVenta').addEventListener('click', function() {
            window.location.href = `/Ventas/Create`;
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.querySelector('.search-input');
            const inputGroup = document.querySelector('.input-group');

            if (searchInput && inputGroup) {
                // Cuando el input recibe foco
                searchInput.addEventListener('focus', function() {
                    inputGroup.classList.add('input-group-active');
                });

                // Cuando el input pierde el foco
                searchInput.addEventListener('blur', function() {
                    inputGroup.classList.remove('input-group-active');
                });
            }
        });
    </script>
}

<style>
    /* Estilo para fila seleccionada */
    .selected-row td {
        background-color: #21313a !important;
        color: #fff !important;
    }

    /* Cursor pointer para filas */
    .cursor-pointer {
        cursor: pointer;
    }

    /* Ajustes para la tabla sin checkbox */
    .proveedores-table thead th:first-child {
        border-radius: 8px 0 0 0 !important;
    }

    .proveedores-table thead th:last-child {
        border-radius: 0 8px 0 0 !important;
    }

    /* Ajustes para los botones de filtro */
    .btn-outline-secondary {
        border-color: #495057;
        color: #e9ecef;
    }

        .btn-outline-secondary:hover {
            background-color: #495057;
            border-color: #6c757d;
        }

    /* Asegurar que los elementos se alineen correctamente */
    .search-wrapper {
        flex-grow: 1;
    }
</style>